<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <title>Type Ahead ğŸ‘€</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  
  <form class="search-form" v-on:submit.prevent>
    <input type="text" class="search" placeholder="City or State" disabled="disabled" v-model="filter">
    <ul class="suggestions">
      <template v-if="filterModel && filterModel.length">
        <li v-for="(value, key) in filterModel">
          <span class="name" v-html="liHtml(value)"></span>
          <span class="population" v-text="populationToNumber(value.population)"></span>
        </li>
      </template>
      <template v-else>
        <li>Filter for a city</li>
        <li>or a state</li>
      </template>
    </ul>
  </form>
  
  <script src='https://cdnjs.cloudflare.com/ajax/libs/vue/2.5.17/vue.js'></script>
  <script>
    (function () {
      const endpoint = 'https://gist.githubusercontent.com/Miserlou/c5cd8364bf9b2420bb29/raw/2bf258763cdddd704f8ffd3ea9a3e81d25e2c6f6/cities.json';
      const input = document.querySelector('.search');
      const ul = document.querySelector('.suggestions');
      
      const app = new Vue({
        // Vue ç®¡ç†çš„ DOM
        'el': '.search-form',
        
        'data': {
          'model': [],
          'filter': '',
        },
        
        // ä¿å­˜ Vue è¨ˆç®—å¾Œçš„ç‰©ä»¶
        // ç•¶ä½ éœ€è¦å°‡ A è³‡æ–™è¨ˆç®—å®Œï¼Œä¸¦è¿”å›æˆ B è³‡æ–™æ™‚çš„å‡½å¼æ”¾åœ¨é€™è£¡
        // computed çš„å±¬æ€§ç›¸å¯ä»¥å† DOM ç•¶åšè®Šæ•¸æˆ– Vue å¯¦é«”å…§ä½¿ç”¨ this ç²å–
        // computed çš„å±¬æ€§å€¼å¿…é ˆæ˜¯å‡½å¼ï¼Œè€Œä¸”ä¸€å®šè¦æœ‰è¿”å›å€¼
        'computed': {
          'filterModel': function () {
            if (!this.filter.trim()) return [];

            const self = this;

            return this.model.filter(function (item) {
              // match() å­—ä¸²æ–¹æ³•ï¼Œæœå°‹å­—ä¸²å…§æœ‰æ²’æœ‰åƒæ•¸çš„å­—ä¸²ï¼Œè‹¥æœ‰å‰‡è¿”å›é™£åˆ—ï¼Œè‹¥ç„¡å‰‡è¿”å› null
              // åƒæ•¸æ‡‰è©²æ˜¯æ­£è¦è¡¨é”å¼
              // let str = 'Filter For A City Filter For A City Filter For A City';
              // let regexp = new RegExp(/A/); -> ['A'];
              // let regexp = new RegExp(/A/, 'gi'); -> ['A', 'A', 'A'];
              // é€™è£¡ä¸éœ€è¦ match æ–¹æ³•è¿”å›çš„é™£åˆ—ï¼Œåªéœ€è¦åˆ©ç”¨é™£åˆ—èˆ‡ null é€²è¡Œ true or false çš„åˆ¤æ–·
              return item.city.match(self.regexp) || item.state.match(self.regexp);
            });
          },
          
          // ä¾ç…§ .search çš„ value éš¨æ™‚ä¿®æ”¹æ­£å‰‡è¡¨é”å¼
          'regexp': function () {
            return new RegExp(this.filter, 'gi');
          },
        },
        
        // ä¿å­˜ Vue æ–¹æ³•çš„ç‰©ä»¶
        // computed çš„å±¬æ€§ç›¸å¯ä»¥å† DOM ç•¶åšè®Šæ•¸(å‡½å¼)æˆ– Vue å¯¦é«”å…§ä½¿ç”¨ this ç²å–
        // computed çš„å±¬æ€§å€¼å¿…é ˆæ˜¯å‡½å¼
        'methods': {
          'liHtml': function (item) {
            let name = `${item.city}, ${item.state}`;
            
            name = name.replace(this.regexp, function (match, key) {
              return `<span class="hl">${match}</span>`;
            });
            
            // toLocaleString() æ•¸å­—æ–¹æ³•ï¼Œé€™è£¡é è¨­æ˜¯åŠ ä¸Šåƒåˆ†ä½ç¬¦è™Ÿ
            return `<span class="name">${name}</span>`;
          },

          'populationToNumber': function (str) {
            return Number(str).toLocaleString();
          },
        },
        
        // ç”Ÿå‘½é€±æœŸï¼Œåœ¨ Vue å¯¦é«”å‰µå»ºå¾Œèˆ‡ Vue è®€å–è‡ªèº«å±¬æ€§å‰
        'mounted': function () {
          const self = this;
          fetch('./data.json').then(function (response) {
            return response.json();
          }).then(function (json) {
            self.model = json;

            document.querySelector('.search').disabled = '';
          });
        },
      });
    })();
  </script>
</body>
</html>
